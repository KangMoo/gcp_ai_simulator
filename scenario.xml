<?xml version="1.0" encoding="UTF-8" standalone="yes"?>  
<scenario name="pizza_order">
    <tts>안녕하세요. 미스터피자입니다. 본 매장은 배달 전용 매장입니다.</tts>

    <mark>pizza_select</mark>
    <tts>주문하실 피자의 이름을 말씀해주세요. 피자는 페퍼로니, 고구마, 포테이토가 제공됩니다.</tts>
    <stt duration="5000">pizza_menu</stt>

    <if>
        <expression><![CDATA[ 
            typeof pizza_menu === 'undefined' || !(pizza_menu.includes("고구마") ||  pizza_menu.includes("페퍼로니") || pizza_menu.includes("포테이토"))]]></expression>
        <jump>pizza_reselect</jump>
    </if>

    <run>
        <![CDATA[ 
        if(pizza_menu.includes("고구마")) pizza_menu = "고구마";
        else if(pizza_menu.includes("페퍼로니")) pizza_menu = "페퍼로니";
        else if(pizza_menu.includes("포테이토")) pizza_menu = "포테이토";
        ]]>
    </run>
    <mark>size_select</mark>
    <tts>${pizza_menu} 피자는 2가지 사이즈로 제공됩니다. 레귤러 사이즈와 라지 사이즈 중 원하시는 것을 말씀해주세요</tts>
    <stt duration="5000">pizza_size</stt>

    <if>
        <expression><![CDATA[ typeof pizza_size === 'undefined' || !(pizza_size.includes("레귤러") ||  pizza_size.includes("라지"))]]></expression>
        <jump>size_reselect</jump>
    </if>

    <run>
        <![CDATA[ 
        if(pizza_size.includes("레귤러")) pizza_size = "레귤러";
        else if(pizza_size.includes("라지")) pizza_size = "라지";
        ]]>
    </run>

    <tts>${pizza_size} 사이즈를 고르셨습니다.</tts>

    <mark>edge_select</mark>
    <tts>${pizza_menu} 피자의 엣지는 오리진, 골드, 크림치즈, 에그타르트, 치즈캡이 제공됩니다. 원하시는 엣지 유형을 골라주세요</tts>
    <stt duration="5000">pizza_edge</stt>
    
    <if>
        <expression><![CDATA[
            typeof pizza_edge === 'undefined' ||
            !(pizza_edge.includes("오리진") ||  
            pizza_edge.includes("골드") ||
            pizza_edge.includes("크림치즈") ||
            pizza_edge.includes("에그타르트") ||
            pizza_edge.includes("치즈캡"))]]></expression>
        <jump>edge_reselect</jump>
    </if>

    <run>
        <![CDATA[
        if(pizza_edge.includes("오리진")) pizza_edge="오리진"; 
        else if(pizza_edge.includes("골드")) pizza_edge="골드";  
        else if(pizza_edge.includes("크림치즈")) pizza_edge="크림치즈"; 
        else if(pizza_edge.includes("에그타르트")) pizza_edge="에그타르트"; 
        else if(pizza_edge.includes("치즈캡")) pizza_edge="치즈캡"; 
        ]]>
    </run>
    
    <tts>${pizza_edge} 엣지를 고르셨습니다.</tts>

    <mark>count_select</mark>
    <tts>피자의 주문 수량을 말씀해주세요</tts>
    <stt duration="5000" digit="true">pizza_count</stt>

    <if>
        <expression><![CDATA[
            typeof pizza_count === 'undefined' || Number.isNaN(Number(pizza_count))
            ]]></expression>
        <jump>count_reselect</jump>
    </if>

    <mark>drink_select</mark>
    <tts>음료를 골라주세요. 음료는 콜라와 사이다가 제공됩니다</tts>
    <stt duration="5000">drink</stt>
    
    <if>
        <expression><![CDATA[
            typeof drink === 'undefined' ||
            !(drink.includes("콜라") ||  
            drink.includes("사이다"))]]></expression>
        <jump>drink_reselect</jump>
    </if>

    <run>
        <![CDATA[
        if(drink.includes("콜라")) drink="콜라"; 
        else if(drink.includes("사이다")) drink="사이다"; 
        ]]>
    </run>

    <tts>${drink} 음료를 고르셨습니다</tts>
    <mark>drink_count_select</mark>
    <tts>음료 개수를 말씀해주세요.</tts>
    <stt duration="5000" digit="true">drink_count</stt>

    <if>
        <expression><![CDATA[
            typeof drink_count === 'undefined' || Number.isNaN(Number(drink_count))
            ]]></expression>
        <jump>drink_count_reselect</jump>
    </if>

    <mark>order_confirm</mark>
    <tts>주문하신 피자는 ${pizza_menu}, 사이즈는 ${pizza_size}, 엣지는 ${pizza_edge}, 주문수량은 ${pizza_count} 입니다.
        음료는 ${drink}, 갯수는 ${drink_count}입니다. 주문하신 정보가 맞습니까?</tts>
    <stt duration="5000">confirm</stt>

    <if>
        <expression><![CDATA[ 
            typeof confirm !== 'undefined' && confirm.includes("아니오")
            ]]></expression>
        <jump>reorder</jump>
    </if>

    <if>
        <expression><![CDATA[ 
            typeof confirm === 'undefined' ||
            !(confirm.includes("예") || confirm.includes("네"))]]></expression>
        <jump>order_reconfirm</jump>
    </if>

    <tts>감사합니다. 등록하신 주소로 1시간 내로 배달드리겠습니다</tts>
    <jump>scenario_end</jump>

    <mark>pizza_reselect</mark>
    <tts>죄송합니다. 주문하신 피자는 제공되지 않습니다</tts>
    <jump>pizza_select</jump>

    <mark>size_reselect</mark>
    <tts>죄송합니다. 말씀하신 사이즈는 제공되지 않습니다</tts>
    <jump>size_select</jump>

    <mark>edge_reselect</mark>
    <tts>죄송합니다. 말씀하신 엣지는 제공되지 않습니다</tts>
    <jump>edge_select</jump>

    <mark>count_reselect</mark>
    <tts>죄송합니다. 말씀을 이해하지 못했습니다</tts>
    <jump>count_select</jump>

    <mark>drink_reselect</mark>
    <tts>죄송합니다. 말씀하신 음료는 제공되지 않습니다</tts>
    <jump>drink_select</jump>

    <mark>drink_count_reselect</mark>
    <tts>죄송합니다. 말씀을 이해하지 못했습니다.</tts>
    <jump>drink_count_select</jump>

    <mark>reorder</mark>
    <tts>주문 메뉴를 다시 받겠습니다.</tts>
    <jump>pizza_select</jump>

    <mark>order_reconfirm</mark>
    <tts>죄송합니다. 말씀을 이해하지 못했습니다.</tts>
    <jump>order_confirm</jump>

    <mark>scenario_end</mark>
</scenario>