<?xml version="1.0" encoding="UTF-8" standalone="yes"?>  
<scenario name="pizza_order">
    <tts>안녕하세요. 도미노 피자입니다. 본 매장은 배달 전용 매장입니다.</tts>
    <tts>주문하실 피자의 메뉴, 사이즈, 엣지 그리고 수량을 말씀해주세요.</tts>
    <stt duration="8000">msg</stt>

    <mark>pizza_select</mark>

    <run>
        <![CDATA[
        if(typeof msg !== 'undefined' && msg != null){
            if(msg.includes("고구마")) pizza_menu = "고구마";
            else if(msg.includes("페퍼로니")) pizza_menu = "페퍼로니";
            else if(msg.includes("포테이토")) pizza_menu = "포테이토";

            if(msg.includes("레귤러")) pizza_size = "레귤러";
            else if(msg.includes("라지")) pizza_size = "라지";

            if(msg.includes("오리진")) pizza_edge="오리진";
            else if(msg.includes("골드")) pizza_edge="골드";
            else if(msg.includes("크림치즈")) pizza_edge="크림치즈";
            else if(msg.includes("에그타르트")) pizza_edge="에그타르트";
            else if(msg.includes("치즈캡")) pizza_edge="치즈캡";

            // 숫자 확인
            if(msg.match(/\d+/g) != null) pizza_count = msg.match(/\d+/g)[0];
        }
        ]]>
    </run>

    <if>
        <expression><![CDATA[
        typeof pizza_menu === 'undefined' || pizza_menu == null ||
        !(pizza_menu.includes("고구마") ||  pizza_menu.includes("페퍼로니") || pizza_menu.includes("포테이토"))]]>
        </expression>
        <jump>pizza_menu_select</jump>
    </if>

    <if>
        <expression><![CDATA[
        typeof pizza_size === 'undefined' || pizza_size == null ||
         !(pizza_size.includes("레귤러") ||  pizza_size.includes("라지"))]]>
        </expression>
        <jump>pizza_size_select</jump>
    </if>

    <if>
        <expression><![CDATA[
        typeof pizza_edge === 'undefined' || pizza_edge == null ||
        !(pizza_edge.includes("오리진") ||  pizza_edge.includes("골드") || pizza_edge.includes("크림치즈") || pizza_edge.includes("에그타르트") || pizza_edge.includes("치즈캡"))]]>
        </expression>
        <jump>pizza_edge_select</jump>
    </if>

    <if>
        <expression><![CDATA[
        typeof pizza_count === 'undefined' || Number.isNaN(Number(pizza_count))]]>
        </expression>
        <jump>pizza_count_select</jump>
    </if>

    <jump>pizza_select_done</jump>

    <!-- #################### -->

    <mark>pizza_menu_select</mark>
    <tts>주문하실 피자의 이름을 말씀해주세요. 피자는 페퍼로니, 고구마, 포테이토가 제공됩니다.</tts>
    <stt duration="5000">msg</stt>

    <if>
        <expression><![CDATA[
            typeof msg === 'undefined' || !(msg.includes("고구마") ||  msg.includes("페퍼로니") || msg.includes("포테이토"))]]></expression>
        <jump>recognize_fail</jump>
    </if>
    <jump>pizza_select</jump>

    <mark>pizza_size_select</mark>
    <tts>${pizza_menu} 피자는 2가지 사이즈로 제공됩니다. 레귤러 사이즈와 라지 사이즈 중 원하시는 것을 말씀해주세요</tts>
    <stt duration="5000">msg</stt>
    <if>
        <expression><![CDATA[ typeof msg === 'undefined' || !(msg.includes("레귤러") ||  msg.includes("라지"))]]></expression>
        <jump>recognize_fail</jump>
    </if>
    <jump>pizza_select</jump>

    <mark>pizza_edge_select</mark>
    <mark>edge_select</mark>
    <tts>${pizza_menu} 피자의 엣지는 오리진, 골드, 크림치즈, 에그타르트, 치즈캡이 제공됩니다. 원하시는 엣지 유형을 골라주세요</tts>
    <stt duration="5000">msg</stt>
    <if>
        <expression><![CDATA[typeof msg === 'undefined' || !(msg.includes("오리진") || msg.includes("골드") || msg.includes("크림치즈") || msg.includes("에그타르트") || msg.includes("치즈캡"))]]></expression>
        <jump>recognize_fail</jump>
    </if>
    <jump>pizza_select</jump>

    <mark>pizza_count_select</mark>
    <tts>피자의 주문 수량을 말씀해주세요</tts>
    <stt duration="5000" digit="true">msg</stt>
    <if>
        <expression><![CDATA[typeof msg === 'undefined' || msg.match(/\d+/g) == null]]></expression>
        <jump>recognize_fail</jump>
    </if>
    <jump>pizza_select</jump>

    <mark>pizza_select_done</mark>
    <tts>네. ${pizza_menu} 피자 ${pizza_edge} 엣지 ${pizza_size} 사이즈로 ${pizza_count}개 주문 하셨습니다. </tts>
    <tts>다음으로 주문하실 음료와 갯수를 말씀해주세요</tts>
    <stt duration="5000">msg</stt>

    <mark>drink_select</mark>

    <run>
        <![CDATA[
        if(typeof msg !== 'undefined' && msg != null){
            if(msg.includes("콜라")) drink_menu = "콜라";
            else if(msg.includes("사이다")) drink_menu = "사이다";

            // 숫자 확인
            if(msg.match(/\d+/g) != null) drink_count = msg.match(/\d+/g)[0];
        }
        ]]>
    </run>

    <if>
        <expression>
            <![CDATA[typeof drink_menu === 'undefined' || drink_menu == null || !(drink_menu.includes("콜라") ||  drink_menu.includes("사이다"))]]>
        </expression>
        <jump>drink_menu_select</jump>
    </if>

    <if>
        <expression><![CDATA[
        typeof drink_count === 'undefined' || Number.isNaN(Number(drink_count))]]>
        </expression>
        <jump>drink_count_select</jump>
    </if>

    <jump>drink_select_done</jump>

    <mark>drink_menu_select</mark>
    <tts>음료를 골라주세요. 음료는 콜라와 사이다가 제공됩니다</tts>
    <stt duration="5000">msg</stt>
    <if>
        <expression><![CDATA[typeof msg === 'undefined' || !(msg.includes("콜라") || msg.includes("사이다"))]]></expression>
        <jump>recognize_fail</jump>
    </if>
    <jump>drink_select</jump>

    <mark>drink_count_select</mark>
    <tts>음료 개수를 말씀해주세요.</tts>
    <stt duration="5000" digit="true">msg</stt>
    <if>
        <expression><![CDATA[typeof msg === 'undefined' || msg.match(/\d+/g) == null]]></expression>
        <jump>recognize_fail</jump>
    </if>
    <jump>drink_select</jump>

    <mark>drink_select_done</mark>

    <tts>네. 주문 확인하겠습니다. 주문하신 피자는 ${pizza_menu}, 사이즈는 ${pizza_size}, 엣지는 ${pizza_edge}, 주문수량은 ${pizza_count}개 입니다. 음료는 ${drink_menu}, 갯수는 ${drink_count}개 입니다. 주문하신 정보가 맞습니까?</tts>
    <stt duration="5000">confirm</stt>
    <if>
        <expression><![CDATA[typeof confirm !== 'undefined' && confirm.includes("아니오")]]></expression>
        <jump>reorder</jump>
    </if>

    <if>
        <expression><![CDATA[typeof confirm === 'undefined' || !(confirm.includes("예") || confirm.includes("네"))]]></expression>
        <jump>recognize_fail</jump>
    </if>

    <tts>감사합니다. 등록하신 주소로 1시간 내로 배달드리겠습니다</tts>

    <jump>scenario_end</jump>

    <mark>recognize_fail</mark>
    <tts>죄송합니다. 말씀을 이해하지 못했습니다</tts>
    <if>
        <expression><![CDATA[
        typeof pizza_menu === 'undefined' || pizza_menu == null ||
        typeof pizza_size === 'undefined' || pizza_size == null ||
        typeof pizza_edge === 'undefined' || pizza_edge == null]]></expression>
        <jump>pizza_select</jump>
    </if>
    <jump>drink_select</jump>

    <mark>reorder</mark>
    <tts>주문 메뉴를 다시 받겠습니다</tts>
    <run>
        <![CDATA[
        pizza_menu = null; pizza_size = null; pizza_edge = null; pizza_count = null; drink = null; pizza_count = null;
        ]]>
    </run>
    <jump>pizza_select</jump>

    <mark>scenario_end</mark>
</scenario>


